# Задание 5. Проектирование технологического стека и расчёт стоимости

## Задача 1. Целевой технологический стек

## Базовый Технологический радар

* Языки программирования и фреймворки
  * Python 3.13 (Adopt)
  * FastAPI (Adopt)
  * Playwright (Adopt)
  * SqlAlchemy 2 (Adopt)
  * Go (Adopt)

* Инструменты разработки (включая AI-помощников!)
  * PyCharm (Adopt)
  * Windsurf (Adopt)
  * VS Code (Assess)
  * Cursor (Assess)
  * Claude Code (Assess)
  * GitLab (Adopt)
 
* Методы проектирования и разработки
  * Data Mesh (Adopt)
  * Self Service (Adopt)
  * Event-Driven Architecture (Trial)
  * DDD и микросервисный подход (Adopt)
  * Быстрое прототипирование с помощью вайбкодинга + TDD
  * IaC (Trial)
  * Шифрование персональных данных при хранении (Trial)

* Platform Services
  * Kafka (Adopt)
  * Karapace (Assess)
  * Camel (Hold)
  * Redis Streams (Assess)
  * Microsoft SQL Server (Hold)
  * MinIO (Adopt)
  * Apache Iceberg (Adopt)

## Расширенный технологический радар

### Архитектурные паттерны и подходы

| Технология / Паттерн | Статус | Обоснование |
|---------------------|--------|-------------|
| **Data Mesh** | Adopt | Ключевой паттерн для масштабирования платформы данных при подключении новых подразделений. Позволяет избежать централизованного bottleneck и обеспечить ownership данных на уровне доменов. |
| **Data Lakehouse** | Adopt | Замена legacy DWH на MS SQL Server. Сочетает гибкость Data Lake и транзакционность DWH. Реализуется через MinIO + Iceberg + Spark. |
| **Event-Driven Architecture** | Trial | Применяется для междоменных интеграций через Kafka. Не подходит для внутридоменных синхронных операций и критичных финансовых транзакций. |
| **Self-Service BI** | Adopt | Портал самообслуживания для аналитиков — ключевое требование бизнеса. Реализуется через Trino + JupyterHub + каталог данных. |
| **Self-Service Infrastructure** | Trial | IaC-подход: команды заказывают инфраструктуру через Git-коммиты в Terraform-репозиторий. |
| **Domain-Driven Design (DDD)** | Adopt | Основа для выделения bounded contexts и определения владельцев данных в Data Mesh. |
| **GitOps / Infrastructure as Code** | Trial | Terraform + GitLab CI для автоматизированного развёртывания инфраструктуры по требованию. |
| **Zero Trust Security** | Assess | Оценка применимости для защиты данных между доменами. Keycloak + Ranger как базовые компоненты. |
| **CQRS** | Assess | Потенциально полезен для разделения read/write нагрузки в аналитических сценариях. |

### Платформа данных (Data Platform)

| Технология | Статус | Обоснование |
|------------|--------|-------------|
| **Apache Iceberg** | Adopt | Табличный формат для Data Lakehouse. ACID-транзакции, time-travel, schema evolution. |
| **MinIO** | Adopt | S3-совместимое объектное хранилище для on-premise. Хранит сырые данные и Iceberg-таблицы. |
| **Apache Spark** | Adopt | Основной движок распределённых вычислений. Клиентский режим в K8s. |
| **Nessie** | Trial | Git-like каталог для версионирования Iceberg-таблиц. Позволяет branching/merging данных. |
| **DataHub** | Trial | Каталог данных с поддержкой Data Access Workflows. Ключевой компонент Self-Service. |
| **Apache Ranger** | Trial | IAM/ACL для Iceberg-таблиц. Интеграция с Keycloak. |
| **Trino** | Adopt | SQL-движок для федеративных запросов к Iceberg, ClickHouse и другим источникам. |
| **ClickHouse** | Adopt | OLAP-БД для аналитических витрин с низкой латентностью. |
| **Apache Airflow** | Adopt | Оркестратор ETL-процессов. DAG-и запускают Spark-джобы. |
| **Great Expectations** | Assess | Валидация качества данных. Потенциальная интеграция с DataHub. |
| **dbt** | Assess | Трансформации данных как код. Альтернатива/дополнение к Spark для SQL-трансформаций. |
| **Microsoft SQL Server** | Hold | Legacy DWH. Планируется постепенный вывод из эксплуатации. |

### Событийная архитектура (Event Streaming)

| Технология | Статус | Обоснование |
|------------|--------|-------------|
| **Apache Kafka** | Adopt | Центральная шина событий для междоменных интеграций. |
| **Karapace** | Trial | Schema Registry для Kafka. Open-source альтернатива Confluent Schema Registry. |
| **Redis Streams** | Assess | Для мультитенантной EDA с гранулярным доступом (события по конкретному счёту/клиенту). |
| **Apache Camel** | Hold | Legacy интеграционная шина. Заменяется на Kafka + прямые интеграции. |

### Инфраструктура и DevOps

| Технология | Статус | Обоснование |
|------------|--------|-------------|
| **Kubernetes** | Adopt | Основная платформа оркестрации. Три кластера: MinIO, Spark, общего назначения. |
| **Terraform** | Adopt | IaC для автоматизированного развёртывания инфраструктуры. |
| **GitLab CI/CD** | Adopt | Пайплайны для CI/CD и GitOps (развёртывание инфраструктуры по коммиту). |
| **Helm** | Adopt | Пакетный менеджер для Kubernetes. |
| **Kyverno** | Trial | Policy engine для K8s. Политики безопасности, ограничение ресурсов Spark-приложений. |
| **ProxMox / OpenStack** | Trial | Гипервизор для инфраструктуры по требованию (ВМ, K8s-кластеры). |
| **Prometheus + Grafana** | Adopt | Мониторинг и алертинг. |
| **ELK / Loki** | Trial | Централизованное логирование. |
| **Jaeger / Tempo** | Assess | Distributed tracing для диагностики проблем. |

### Безопасность и Identity

| Технология | Статус | Обоснование |
|------------|--------|-------------|
| **Keycloak** | Adopt | SSO и IAM. Единая точка аутентификации для всех сервисов. |
| **Kerberos** | Trial | Аутентификация для Spark, Ranger и других Hadoop-совместимых компонентов. |
| **HashiCorp Vault** | Assess | Управление секретами. Потенциальная замена Kubernetes Secrets. |

### Языки и фреймворки

| Технология | Статус | Обоснование |
|------------|--------|-------------|
| **Python 3.13** | Adopt | Основной язык для ETL, Data Science, ИИ-сервисов. |
| **PySpark** | Adopt | Python API для Spark. |
| **FastAPI** | Adopt | Фреймворк для REST API сервисов. |
| **Go** | Adopt | Для высокопроизводительных микросервисов (финтех). |
| **Java** | Adopt | Legacy финтех-сервисы. Поддержка, но не новая разработка. |
| **SQLAlchemy 2** | Adopt | ORM для Python. |

### Инструменты разработки

| Технология | Статус | Обоснование |
|------------|--------|-------------|
| **PyCharm** | Adopt | IDE для Python-разработки. |
| **Windsurf** | Adopt | AI-assisted IDE. |
| **VS Code** | Assess | Альтернативная IDE, особенно для Go и DevOps. |
| **Cursor / Claude Code** | Assess | AI-помощники для кодинга. |
| **JupyterHub** | Adopt | Интерактивные ноутбуки для прототипирования и аналитики. |
| **Coder** | Trial | Удалённые рабочие окружения для разработчиков. |

### Визуализация радара

```
                        ADOPT                           TRIAL                          ASSESS                         HOLD
┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│ АРХИТЕКТУРА    Data Mesh, Data Lakehouse,     EDA, Self-Service Infra,      Zero Trust, CQRS                                   │
│                Self-Service BI, DDD            GitOps/IaC                                                                        │
├─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ DATA PLATFORM  Iceberg, MinIO, Spark,         Nessie, DataHub, Ranger       Great Expectations, dbt      MS SQL Server         │
│                Trino, ClickHouse, Airflow                                                                                        │
├─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ EVENTS         Kafka                           Karapace                       Redis Streams                 Apache Camel        │
├─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ INFRA          K8s, Terraform, GitLab,        Kyverno, ProxMox, ELK/Loki    Jaeger/Tempo                                        │
│                Helm, Prometheus+Grafana                                                                                          │
├─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ SECURITY       Keycloak                        Kerberos                       HashiCorp Vault                                    │
├─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ LANGUAGES      Python, PySpark, FastAPI,                                                                    Java (legacy)       │
│                Go, SQLAlchemy                                                                                                    │
├─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│ DEV TOOLS      PyCharm, Windsurf, JupyterHub  Coder                          VS Code, Cursor, Claude Code                       │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

### Критерии статусов

| Статус | Описание |
|--------|----------|
| **Adopt** | Рекомендуется к использованию. Технология проверена и готова к production. |
| **Trial** | Можно использовать в пилотных проектах. Требуется накопление экспертизы. |
| **Assess** | Стоит изучить и оценить применимость. Не использовать в production без согласования. |
| **Hold** | Не рекомендуется для новых проектов. Поддержка существующих систем, планируется вывод. |



## Задача 2. Экономическое обоснование трансформации

> Разработайте экономическое обоснование трансформации, описав модель TCO (Total Cost of Ownership) для текущей и целевой архитектуры. Укажите основные статьи затрат, включая инфраструктуру, лицензии, сопровождение, время аналитиков, и сравните их на горизонте трёх лет.

### Исходные данные для расчёта

| Параметр | Значение |
|----------|----------|
| Текущий объём данных | 300 Тб (с резервированием — 600 Тб) |
| Прогнозируемый объём через 3 года | 1 Пб (с резервированием — 2 Пб) |
| Средний рост данных в год | ~233 Тб/год |
| Тип данных | Преимущественно неструктурированные (медицинские снимки, документы) |

### Почему выгодно заменить MS SQL Server на LakeHouse

#### Проблемы текущей архитектуры

1. **Стоимость лицензий MS SQL Server Enterprise**
   - $15,123 за 2-core pack ([официальные цены Microsoft](https://www.microsoft.com/en-us/sql-server/sql-server-2022-pricing))
   - Для кластера на 600 Тб нужно минимум 64+ ядер = **~$484,000** только на лицензии
   - При масштабировании до 2 Пб — пропорциональный рост

2. **Антипаттерны использования**
   - MS SQL Server используется для хранения неструктурированных данных (снимки, документы) — неэффективно
   - Отсутствуют аналитические витрины — каждый отчёт работает с сырыми данными
   - Производительность деградирует при росте объёмов

3. **Ограничения масштабирования**
   - Enterprise требуется для кэша данных >128 ГБ
   - Вертикальное масштабирование упирается в физические лимиты серверов

#### Преимущества LakeHouse (MinIO + Iceberg + Spark)

1. **Нулевые лицензионные затраты** — весь стек open-source
2. **Горизонтальное масштабирование** — добавляем узлы по мере роста
3. **Разделение хранения и вычислений** — оптимизация затрат
4. **Эффективность хранения** — колоночный формат Parquet/ORC сжимает данные в 3-10 раз
5. **ACID-транзакции** — Iceberg обеспечивает консистентность

---

### Сравнение TCO на горизонте 3 года

#### Сценарий 1: On-Premise MS SQL Server DWH

##### Архитектура: 4 Compute-сервера + 10 Storage-серверов (SAN)

SQL Server — не распределённая система. Для петабайтного DWH используется архитектура с отдельным хранилищем:
- **4 мощных compute-сервера** (SQL Server с AlwaysOn AG)
- **10 storage-серверов** (SAN-массив, 2.6 ПБ сырой ёмкости)

##### Compute-серверы SQL Server (4 шт) — 3,961,716 ₽/шт

| Компонент | Спецификация | Кол-во | Цена за ед. | Итого |
|-----------|--------------|--------|-------------|-------|
| CPU | [Intel Xeon Platinum 8480+ (56C)](https://digital-tex.ru/catalog/komplektuyushchie/komplektuyushchie_dlya_serverov/protsessory/protsessor_intel_xeon_platinum_8480_pk8071305074801srm7h/) × 2 | 8 | 898,098 ₽ | 7,184,784 ₽ |
| RAM | DDR5 128GB ECC Samsung × 8 = 1TB/узел | 32 | 115,000 ₽ | 3,680,000 ₽ |
| NVMe TempDB | [Samsung PM9A3 7.68TB](https://secumarket.ru/product/pm9a3-7-68tb-mzql27t6hbla-00a07-122584) × 4 | 16 | 134,880 ₽ | 2,158,080 ₽ |
| Сеть 100GbE | [Mellanox ConnectX-6 Dx](https://3logic.ru/products/mcx623106ac-cdat-connectx-6-dx-en-adapter-card-100gbe-dual-port-qsfp56-pcie-4-0-x16-crypto-and--90098/) | 4 | 106,000 ₽ | 424,000 ₽ |
| Платформа 2U | Dual Socket Server | 4 | 600,000 ₽ | 2,400,000 ₽ |
| **Итого Compute** | | | | **15,846,864 ₽** |

##### Storage-серверы SAN (10 шт) — 1,320,000 ₽/шт

| Компонент | Спецификация | Кол-во | Цена за ед. | Итого |
|-----------|--------------|--------|-------------|-------|
| HDD | [WD/Seagate 22TB SATA](https://www.regard.ru/reciept/30948123/servernye-zestkie-diski-hdd-22-tb) × 12 | 120 | 47,000 ₽ | 5,640,000 ₽ |
| RAID-контроллер | Enterprise HBA/RAID | 10 | 150,000 ₽ | 1,500,000 ₽ |
| Сеть 100GbE | [Mellanox ConnectX-6 Dx](https://3logic.ru/products/mcx623106ac-cdat-connectx-6-dx-en-adapter-card-100gbe-dual-port-qsfp56-pcie-4-0-x16-crypto-and--90098/) | 10 | 106,000 ₽ | 1,060,000 ₽ |
| Платформа 2U 12LFF | Storage Server | 10 | 500,000 ₽ | 5,000,000 ₽ |
| **Итого Storage** | | | | **13,200,000 ₽** |

##### Сетевая инфраструктура

| Компонент | Стоимость |
|-----------|-----------|
| Коммутаторы 100GbE (Spine-Leaf) | ~6,000,000 ₽ |
| Кабели, оптика, DAC | ~2,500,000 ₽ |
| **Итого сеть** | **~8,500,000 ₽** |

##### Инфраструктура

| Компонент | Стоимость |
|-----------|-----------|
| Серверные стойки 42U + PDU | ~500,000 ₽ |
| ИБП 40 кВА | ~1,000,000 ₽ |
| **Итого инфраструктура** | **~1,500,000 ₽** |

##### **Итого оборудование: ~39,064,000 ₽**

##### Лицензии MS SQL Server Enterprise

| Статья | Расчёт | Стоимость |
|--------|--------|-----------|
| Ядра | 4 сервера × 2 CPU × 56 cores = **448 ядер** | — |
| 2-core packs | 224 шт × $15,123 = $3,387,552 | — |
| Курс USD/RUB | ×100 ₽ | **~338,755,200 ₽** |
| Software Assurance (3 года) | 25% в год × 3 | **~254,066,400 ₽** |
| **Итого лицензии** | | **~592,821,600 ₽** |

*Примечание: лицензии составляют **93.8%** от общей стоимости решения.*

##### Персонал

| Роль | Кол-во | Зарплата gross/мес | С налогами (×1.43) | За 3 года |
|------|--------|-------------------|-------------------|-----------|
| DBA MS SQL | 3 | 250,000 ₽ | 357,500 ₽ | 38,610,000 ₽ |
| Системный администратор | 2 | 200,000 ₽ | 286,000 ₽ | 20,592,000 ₽ |
| **Итого персонал** | | | | **59,202,000 ₽** |

##### Прочие расходы

| Статья | Стоимость за 3 года |
|--------|---------------------|
| Электроэнергия (~30 кВт × 24 × 365 × 3 × 8 ₽/кВтч) | ~6,300,000 ₽ |
| Охлаждение и ЦОД | ~4,000,000 ₽ |
| Поддержка оборудования (5% в год) | ~5,900,000 ₽ |
| **Итого прочее** | **~16,200,000 ₽** |

##### **ИТОГО TCO On-Premise MS SQL Server: ~707,288,000 ₽ (~$7,073,000)**

---

#### Сценарий 2: Облачный MS SQL Server (Yandex Cloud)

##### Вычислительные ресурсы Yandex Managed Service for SQL Server

| Ресурс | Конфигурация | Цена/мес | За 3 года |
|--------|--------------|----------|-----------|
| Кластер SQL Server | s3-c96-m576 × 4 узла | ~1,200,000 ₽ | 43,200,000 ₽ |
| Хранилище SSD | 2 Пб (растущее) в среднем 1.3 Пб | ~2,600,000 ₽ | 93,600,000 ₽ |
| Резервное копирование | ~200 Тб | ~100,000 ₽ | 3,600,000 ₽ |
| Сеть (egress) | ~100 Тб/мес | ~500,000 ₽ | 18,000,000 ₽ |
| **Итого облако** | | | **158,400,000 ₽** |

##### Лицензии MS SQL Server Enterprise

| Статья | Расчёт | Стоимость |
|--------|--------|-----------|
| Ядра | 4 узла × 96 vCPU = **384 ядра** | — |
| 2-core packs | 192 шт × $15,123 = $2,903,616 | — |
| Курс USD/RUB | ×100 ₽ | **~290,361,600 ₽** |
| Software Assurance (3 года) | 25% в год × 3 | **~217,771,200 ₽** |
| **Итого лицензии** | | **~508,132,800 ₽** |

*Примечание: Yandex Cloud требует BYOL (Bring Your Own License) для MS SQL Server.*

##### Персонал

| Роль | Кол-во | Зарплата gross/мес | С налогами (×1.43) | За 3 года |
|------|--------|-------------------|-------------------|-----------|
| DBA MS SQL | 3 | 250,000 ₽ | 357,500 ₽ | 38,610,000 ₽ |
| Cloud-инженер | 1 | 220,000 ₽ | 314,600 ₽ | 11,325,600 ₽ |
| **Итого персонал** | | | | **49,935,600 ₽** |

##### **ИТОГО TCO Облачный MS SQL Server: ~716,468,400 ₽ (~$7,165,000)**

---

#### Сценарий 3: On-Premise LakeHouse (MinIO + Spark + Iceberg)

##### Конфигурация Storage-кластера (MinIO) — 8 узлов

**Профиль: High Density Storage** — плотность дисков и пропускная способность сети, CPU вторичен.

| Компонент | Спецификация | Кол-во | Цена за ед. | Итого |
|-----------|--------------|--------|-------------|-------|
| Платформа | [Supermicro 6029U-E1CR4T 2U 12LFF](https://serverflow.ru/config/servernaya-platforma-supermicro-superserver-6029u-e1cr4t-2u-12lff-4x-u-2-2x-750w-2x-lga3647/) | 8 | ~400,000 ₽ | 3,200,000 ₽ |
| CPU | Intel Xeon Silver (24C) — входит в базу | 8 | — | — |
| RAM | DDR4 ECC 64GB × 2 = 128GB/узел | 16 | ~15,000 ₽ | 240,000 ₽ |
| HDD Data | [WD Gold 22TB (WD221KRYZ)](https://www.ozon.ru/product/western-digital-22-tb-vnutrenniy-zhestkiy-disk-wd221kryz-924960530/) | 96 (12/узел) | ~55,000 ₽ | 5,280,000 ₽ |
| NVMe Cache | [Micron 7450 PRO 3.84TB U.2](https://shop.nav-it.ru/catalogue/servernye_zhestkie_diski_ssd/micron_7450_pro_3_84tb_nvme_u_3_15mm_ssd_enterprise_solid_state_drive_1_year_oem/) | 16 (2/узел) | ~60,000 ₽ | 960,000 ₽ |
| Сеть 100GbE | [Mellanox ConnectX-6 Dx 100GbE](https://wit.ru/parts/mcx623106ac-cdat-mellanox-connectx-6-dx-en-adapter-card-100gbe-dual-port-qsfp56-pcie-4.0-x16-crypto-and-secure-boot-tall-bracket-1112812) | 8 | ~100,000 ₽ | 800,000 ₽ |
| **Итого Storage** | 8 узлов × ~1.25 млн ₽ | | | **~10,480,000 ₽** |

*Сырая ёмкость: 8 × 12 × 22 ТБ = 2.1 ПБ. С Erasure Coding 4+4 полезная ёмкость ~1 ПБ.*

##### Конфигурация Compute-кластера (Spark) — 10 узлов

**Профиль: Memory Optimized** — много ядер, 1 ТБ RAM на узел, быстрый NVMe для Shuffle.

| Компонент | Спецификация | Кол-во | Цена за ед. | Итого |
|-----------|--------------|--------|-------------|-------|
| Платформа | [Supermicro AS-2024US-TRT 2U](https://serverflow.ru/catalog/servery/server-supermicro-as-2024us-trt-2u-12lf/) | 10 | ~500,000 ₽ | 5,000,000 ₽ |
| CPU | [Intel Xeon Gold 6430 32C](https://www.regard.ru/product/425975/servernyi-processor-intel-xeon-gold-6430-oem) × 2 | 20 | ~150,000 ₽ | 3,000,000 ₽ |
| RAM | [Samsung 64GB DDR5 ECC REG](https://www.regard.ru/product/741968/operativnaia-pamiat-64gb-ddr5-6400mhz-samsung-ecc-rdimm-m321r8ga0pb2-ccp-oem) × 16 = 1TB/узел | 160 | ~25,000 ₽ | 4,000,000 ₽ |
| NVMe Shuffle | [Micron 7450 PRO 3.84TB](https://shop.nav-it.ru/catalogue/servernye_zhestkie_diski_ssd/micron_7450_pro_3_84tb_nvme_u_3_15mm_ssd_enterprise_solid_state_drive_1_year_oem/) × 2 | 20 | ~60,000 ₽ | 1,200,000 ₽ |
| Сеть 25GbE | [Mellanox ConnectX-6 Lx 25GbE](https://market.yandex.ru/card/setevoy-adapter-mellanox-connectx-6-lx-en-adapter-card-25gbe-dual-port-sfp28-pcie-40-x8-no-crypto-tall-bracket-1-year/4300319168) | 10 | ~40,000 ₽ | 400,000 ₽ |
| **Итого Compute** | 10 узлов × ~1.36 млн ₽ | | | **~13,600,000 ₽** |

*Суммарно: 640+ ядер CPU, 10 ТБ RAM — достаточно для обработки 5 ТБ данных в памяти.*

##### Сетевое ядро (Network Backbone)

| Компонент | Спецификация | Кол-во | Цена за ед. | Итого |
|-----------|--------------|--------|-------------|-------|
| Коммутатор 100GbE | [Eltex MES5500-32](https://www.layta.ru/elteks-mes5500-32.html) (32 порта, российский реестр) | 2 | ~1,500,000 ₽ | 3,000,000 ₽ |
| Кабели DAC/Optics | 100G QSFP28 DAC, 25G SFP28 DAC | — | — | ~500,000 ₽ |
| **Итого сеть** | | | | **~3,500,000 ₽** |

##### Стойка и инфраструктура

| Компонент | Стоимость |
|-----------|-----------|
| Серверная стойка 42U + PDU | ~300,000 ₽ |
| ИБП 20 кВА | ~700,000 ₽ |
| Прочее (кабели, KVM) | ~500,000 ₽ |
| **Итого инфраструктура** | **~1,500,000 ₽** |

##### Лицензии

| Компонент | Стоимость |
|-----------|-----------|
| MinIO, Spark, Iceberg, Kafka, Airflow, etc. | **0 ₽** (open-source, GNU AGPL / Apache 2.0) |

##### **Итого оборудование: ~29,080,000 ₽ (~$290,000)**

##### Персонал

| Роль | Кол-во | Зарплата gross/мес | С налогами (×1.43) | За 3 года |
|------|--------|-------------------|-------------------|-----------|
| Data Engineer | 3 | 280,000 ₽ | 400,400 ₽ | 43,243,200 ₽ |
| DevOps/SRE | 2 | 250,000 ₽ | 357,500 ₽ | 25,740,000 ₽ |
| Системный администратор | 1 | 200,000 ₽ | 286,000 ₽ | 10,296,000 ₽ |
| **Итого персонал** | | | | **79,279,200 ₽** |

##### Прочие расходы

| Статья | Стоимость за 3 года |
|--------|---------------------|
| Электроэнергия (~20 кВт × 24 × 365 × 3 × 8 ₽/кВтч) | ~4,200,000 ₽ |
| Охлаждение и ЦОД (colocation или собственное) | ~3,000,000 ₽ |
| Поддержка оборудования (5% в год) | ~4,400,000 ₽ |
| **Итого прочее** | **~11,600,000 ₽** |

##### **ИТОГО TCO On-Premise LakeHouse: ~138,534,200 ₽ (~$1,385,000)**

---

#### Сценарий 4: Облачный LakeHouse (Yandex Cloud)

##### Вычислительные ресурсы

| Сервис | Конфигурация | Цена/мес | За 3 года |
|--------|--------------|----------|-----------|
| **Object Storage (S3)** | 2 Пб (в среднем 1.3 Пб) | ~650,000 ₽ | 23,400,000 ₽ |
| **Data Proc (Spark)** | s3-c64-m256 × 6 узлов (по запросу, ~40% времени) | ~480,000 ₽ | 17,280,000 ₽ |
| **Managed ClickHouse** | s3-c16-m64 × 3 узла | ~150,000 ₽ | 5,400,000 ₽ |
| **Managed Kafka** | s3-c8-m32 × 3 узла | ~90,000 ₽ | 3,240,000 ₽ |
| **Managed Kubernetes** | 10 узлов s3-c8-m32 | ~200,000 ₽ | 7,200,000 ₽ |
| **Сеть (egress)** | ~50 Тб/мес | ~250,000 ₽ | 9,000,000 ₽ |
| **Резервное копирование** | | ~50,000 ₽ | 1,800,000 ₽ |
| **Итого облако** | | | **67,320,000 ₽** |

##### Персонал

| Роль | Кол-во | Зарплата gross/мес | С налогами (×1.43) | За 3 года |
|------|--------|-------------------|-------------------|-----------|
| Data Engineer | 3 | 280,000 ₽ | 400,400 ₽ | 43,243,200 ₽ |
| Cloud-инженер | 1 | 250,000 ₽ | 357,500 ₽ | 12,870,000 ₽ |
| **Итого персонал** | | | | **56,113,200 ₽** |

##### **ИТОГО TCO Облачный LakeHouse: ~123,433,200 ₽ (~$1,234,000)**

---

### Затраты на миграцию (единовременные)

При переходе на LakeHouse необходимо учесть дополнительные затраты:

#### Доработка систем

| Статья | Трудозатраты | Стоимость |
|--------|--------------|-----------|
| **Доработка BI-систем** (Power BI → Trino/ClickHouse) | 3 разработчика × 3 мес | 3,600,000 ₽ |
| **Доработка ИИ-сервисов** (миграция загрузки снимков) | 2 разработчика × 2 мес | 1,600,000 ₽ |
| **ETL-миграция** (перенос процессов в Airflow/Spark) | 4 разработчика × 4 мес | 6,400,000 ₽ |
| **Интеграционное тестирование** | 2 QA × 2 мес | 1,200,000 ₽ |
| **Итого доработка** | | **12,800,000 ₽** |

*Расчёт: средняя зарплата разработчика 250,000 ₽ gross × 1.43 (налоги) × кол-во × месяцы*

#### Обучение персонала

| Статья | Расчёт | Стоимость |
|--------|--------|-----------|
| Обучение Spark/Iceberg | 20 чел × 5 дней × 15,000 ₽/день | 1,500,000 ₽ |
| Обучение Kafka/EDA | 15 чел × 3 дня × 15,000 ₽/день | 675,000 ₽ |
| Обучение DataHub/Trino | 30 чел × 2 дня × 10,000 ₽/день | 600,000 ₽ |
| Потеря производительности (2 мес) | ~10% от ФОТ команды | 3,000,000 ₽ |
| **Итого обучение** | | **5,775,000 ₽** |

#### **ИТОГО затраты на миграцию: ~18,575,000 ₽**

---

### Сводная таблица TCO (3 года)

| Сценарий | Железо/Облако | Лицензии | Персонал | Прочее | Миграция | **ИТОГО** |
|----------|---------------|----------|----------|--------|----------|-----------|
| **On-Premise MS SQL** | 39.1 млн ₽ | 592.8 млн ₽ | 59.2 млн ₽ | 16.2 млн ₽ | — | **707.3 млн ₽** |
| **Облако MS SQL** | 158.4 млн ₽ | 508.1 млн ₽ | 49.9 млн ₽ | — | — | **716.5 млн ₽** |
| **On-Premise LakeHouse** | 29.1 млн ₽ | 0 ₽ | 79.3 млн ₽ | 11.6 млн ₽ | 18.6 млн ₽ | **138.6 млн ₽** |
| **Облако LakeHouse** | 67.3 млн ₽ | 0 ₽ | 56.1 млн ₽ | — | 18.6 млн ₽ | **142.0 млн ₽** |

### Визуализация сравнения

```
TCO за 3 года (млн ₽)
                                                                                          
On-Premise MS SQL    ██████████████████████████████████████████████████████████████████████  707.3
Облако MS SQL        ███████████████████████████████████████████████████████████████████████ 716.5
On-Premise LakeHouse ██████████████                                                          138.6
Облако LakeHouse     ██████████████                                                          142.0
                     ─────────────────────────────────────────────────────────────────────────────
                     0       100     200     300     400     500     600     700     800
```

### Выводы

1. **LakeHouse в 5 раз дешевле MS SQL** — On-Premise LakeHouse (~138.6 млн ₽) экономит 568.7 млн ₽ (80%) по сравнению с On-Premise MS SQL (~707.3 млн ₽).

2. **Лицензии MS SQL — 84% бюджета**. Именно стоимость лицензий делает SQL Server неконкурентоспособным для петабайтных хранилищ.

3. **On-Premise vs Облако LakeHouse** практически равны по стоимости (~3.4 млн ₽ разница). Выбор зависит от требований к локализации и модели CAPEX/OPEX.

4. **Основная экономия** достигается за счёт:
   - Нулевых лицензионных затрат (open-source стек)
   - Эффективного хранения неструктурированных данных в S3 (HDD вместо SSD)
   - Разделения хранения и вычислений (Storage-Compute Separation)

5. **Рекомендация**: **LakeHouse (On-Premise или Облако)** — единственный экономически обоснованный вариант для петабайтного DWH


## Задача 3. Стратегический план-роадмап по внедрению Data Mesh

### Ключевые роли в Data Mesh

| Роль | Ответственность | Где работает                       |
|------|-----------------|------------------------------------|
| **Data Product Owner** | Владеет данными домена, определяет SLA, отвечает за качество и доступность data product | В каждом домене                    |
| **Data Engineer** | Разрабатывает ETL/ELT-процессы, строит пайплайны данных, поддерживает инфраструктуру домена | В каждом домене и в головном офисе |
| **BI-аналитик** | Создаёт отчёты и дашборды, анализирует данные, формирует бизнес-инсайты | В головном офисе                   |
| **Platform Engineer** | Развивает платформу самообслуживания, создаёт инструменты и шаблоны | Платформенная команда              |
| **Data Architect** | Определяет стандарты, следит за консистентностью архитектуры между доменами | Платформенная команда              |
| **Data Governance Lead** | Управляет политиками доступа, качества данных, compliance | Платформенная команда              |

---

### Этапы внедрения Data Mesh

```
Год 1                          Год 2                          Год 3
├──────────────────────────────┼──────────────────────────────┼──────────────────────────────┤
│  Q1-Q2: Фундамент            │  Q1-Q2: Масштабирование      │  Q1-Q4: Оптимизация          │
│  Q3-Q4: Пилот                │  Q3-Q4: Расширение           │         и зрелость           │
└──────────────────────────────┴──────────────────────────────┴──────────────────────────────┘
```

---

### Фаза 1: Фундамент (Месяцы 1-6)

**Бизнес-цель**: Создать техническую и организационную основу для Data Mesh.

**Quick Win**: Разгрузить legacy DWH уже на этом этапе — вынести неструктурированные данные (изображения, документы, BLOB) в MinIO. Это сразу улучшит производительность MS SQL и облегчит дальнейшую миграцию.

#### Технические активности

| Активность | Срок | Ответственный | Результат |
|------------|------|---------------|-----------|
| **Развёртывание MinIO** | М1-М2 | Platform Engineer | Объектное хранилище в production |
| **Миграция BLOB-данных из DWH** | М2-М4 | Platform + ИИ-команда | Изображения/документы в MinIO, DWH разгружен |
| **Каталогизация DWH** | М1-М4 | Platform + ИИ-команда | Инвентаризация таблиц, выявление владельцев, связей |
| Развёртывание Iceberg + Spark | М2-М4 | Platform Engineer | LakeHouse-стек в production |
| Внедрение DataHub | М3-М5 | Platform Engineer | Каталог данных с поддержкой lineage |
| Настройка Kafka + Karapace | М3-М4 | Platform Engineer | Событийная шина со Schema Registry |
| Создание Terraform-модулей для Self-Service | М4-М6 | Platform Engineer | Шаблоны для развёртывания инфраструктуры |
| Интеграция Keycloak + Ranger | М4-М6 | Platform Engineer | Единая аутентификация и авторизация |

#### Организационные активности

| Активность | Срок | Ответственный | Результат |
|------------|------|---------------|-----------|
| Определение доменов и их границ | М1-М2 | Data Architect | Карта доменов (см. Task 4) |
| Разработка Data Governance политик | М2-М4 | Data Governance Lead | Документ с правилами владения и качества |
| Формирование платформенной команды | М1-М2 | CTO | Команда из 5-7 человек |
| Обучение платформенной команды | М2-М4 | Внешние консультанты | Сертификации Spark, Iceberg, Kafka |

**Milestone**: Платформа готова к пилотному внедрению. Legacy DWH разгружен от BLOB-данных.

---

### Фаза 2: Пилот (Месяцы 7-12)

**Бизнес-цель**: Проверить модель Data Mesh на одном домене, накопить опыт.

#### Выбор пилотного домена

| Домен | Обоснование выбора |
|-------|-------------------|
| **ИИ-сервисы (обработка изображений)** | Уже использует MinIO для изображений (сделано в Фазе 1), команда участвовала в каталогизации, независимый bounded context, высокая мотивация команды |

#### Паттерн миграции: Anti-Corruption Layer

При миграции используем паттерн **Anti-Corruption Layer (ACL)** для изоляции новой архитектуры от legacy:
- **ACL-сервис** транслирует запросы между LakeHouse и legacy DWH
- Новые сервисы работают только с LakeHouse, ACL скрывает legacy
- Постепенное переключение: когда данные мигрированы, ACL перестаёт обращаться к legacy
- Изоляция позволяет развивать новую архитектуру без оглядки на ограничения MS SQL

#### Активности пилота

| Активность | Срок | Результат |
|------------|------|-----------|
| Назначение Data Product Owner | М7 | DPO для ИИ-домена на полной занятости |
| Разработка Anti-Corruption Layer | М7-М8 | ACL-сервис для трансляции запросов legacy ↔ LakeHouse |
| Миграция структурированных данных | М8-М10 | Метаданные изображений, результаты анализа — в Iceberg |
| Создание Data Products | М9-М11 | 3-5 продуктов: витрины для ML-моделей, API для клиник |
| Публикация в DataHub | М10-М11 | Data Products доступны другим доменам |
| Настройка EDA: Клиники → ИИ | М10-М12 | События о новых снимках через Kafka |
| Ретроспектива и корректировка | М12 | Lessons Learned, обновление стандартов |

#### KPI пилота

| Метрика | Целевое значение |
|---------|------------------|
| Время создания нового отчёта | < 2 дней |
| Доступность данных (SLA) | 99.5% |
| Время обнаружения данных в каталоге | < 5 минут |
| NPS от бизнес-пользователей | > 7/10 |

**Milestone**: Пилот успешен, модель подтверждена.

---

### Фаза 3: Масштабирование (Месяцы 13-24)

**Бизнес-цель**: Распространить Data Mesh на все ключевые домены, вывести legacy из критического пути.

#### Подключение новых доменов

| Квартал | Домены | Особенности |
|---------|--------|-------------|
| Q1 (М13-М15) | Финтех (Банк) | Платежи, кредиты — высокие требования к SLA, ACL для legacy |
| Q1 (М13-М15) | Клиники | Приёмы, пациенты — интеграция с ИИ-сервисами через EDA |
| Q2 (М16-М18) | Аналитика (головной офис) | Консолидированная отчётность для акционеров |
| Q3 (М19-М21) | Фармацевтика | Производственные данные, логистика |
| Q4 (М22-М24) | Медицинская электроника | IoT-телеметрия, предиктивное обслуживание |

#### Параллельные активности

| Активность | Срок | Результат |
|------------|------|-----------|
| Автоматизация onboarding доменов | М13-М15 | Self-Service портал для создания домена за 1 день |
| Внедрение Data Quality Framework | М14-М16 | Great Expectations интегрирован в пайплайны |
| Миграция критичных ETL с legacy | М15-М20 | 80% ETL-процессов на Airflow+Spark |
| Вывод Apache Camel | М18-М24 | Все интеграции через Kafka |
| Federated Governance | М16-М20 | Автоматические проверки compliance в CI/CD |

#### KPI масштабирования

| Метрика | Целевое значение |
|---------|------------------|
| Количество Data Products | > 50 |
| Покрытие DataHub (% таблиц с описанием) | > 80% |
| Среднее время onboarding нового домена | < 2 недели |
| Доля self-service запросов (без участия платформы) | > 70% |

**Milestone**: Все ключевые домены в Data Mesh, legacy — только для исторических данных.

---

### Фаза 4: Оптимизация и зрелость (Месяцы 25-36)

**Бизнес-цель**: Достичь полной автономии доменов, отказаться от legacy, включить новые бизнес-направления.

#### Активности

| Активность | Срок | Результат |
|------------|------|-----------|
| Полный вывод MS SQL Server | М25-М30 | Все данные в LakeHouse, legacy выключен |
| Real-time аналитика | М26-М30 | Streaming-витрины на Kafka + ClickHouse |
| Data Marketplace | М28-М32 | Внутренний маркетплейс Data Products |
| Подключение новых подразделений | М30-М36 | Фарма/электроника при M&A — за 1 месяц |
| FinOps для данных | М32-М36 | Chargeback модель: домены платят за потреблённые ресурсы |

#### KPI зрелости

| Метрика | Целевое значение |
|---------|------------------|
| Время подключения нового подразделения | < 1 месяц |
| Доля real-time данных | > 30% |
| Экономия TCO vs legacy | > 40% |
| Data Products в production | > 100 |

**Milestone**: Data Mesh — основная модель работы с данными в компании.

---

### Gantt-диаграмма (упрощённая)

```
                        Год 1                    Год 2                    Год 3
                   Q1   Q2   Q3   Q4       Q1   Q2   Q3   Q4       Q1   Q2   Q3   Q4
                   ─────────────────       ─────────────────       ─────────────────
MinIO + BLOB-миграц████████                                        
Платформа          ░░░░████████                                    
Пилот: ИИ-сервисы           ░░░░████████                           
Финтех + Клиники                        ████████                   
Аналитика                                    ████████              
Фармацевтика                                      ████████         
Электроника                                            ████████    
Вывод Camel                              ░░░░░░░░████████          
Вывод MS SQL                                              ████████████
Real-time                                                  ░░░░████████
FinOps                                                          ████████

████ = активная фаза    ░░░░ = подготовка
```

---

### Бюджет роадмапа

| Фаза | Период | Затраты | Примечание |
|------|--------|---------|------------|
| Фундамент | М1-М6 | ~25 млн ₽ | Инфраструктура + обучение + консультанты |
| Пилот | М7-М12 | ~20 млн ₽ | Миграция данных + найм DPO + доработки |
| Масштабирование | М13-М24 | ~45 млн ₽ | Подключение 4 доменов + автоматизация |
| Оптимизация | М25-М36 | ~30 млн ₽ | Real-time + marketplace + финализация |
| **ИТОГО** | 3 года | **~120 млн ₽** | Включено в TCO LakeHouse |

---

### Риски и митигация

| Риск | Вероятность | Митигация |
|------|-------------|-----------|
| Сопротивление доменов | Высокая | Quick wins в пилоте, амбассадоры изменений |
| Нехватка Data Engineers | Средняя | Программа обучения, найм заранее |
| Затягивание вывода legacy | Высокая | Жёсткие дедлайны, feature freeze для legacy |
| Конфликты владения данными | Средняя | Data Governance Committee, чёткие политики |

---

### Связь с бизнес-целями

| Бизнес-цель | Как Data Mesh помогает | Когда достигается |
|-------------|------------------------|-------------------|
| Портал самообслуживания для аналитиков | DataHub + Trino + JupyterHub | Конец Года 1 |
| Подключение новых подразделений без перестройки | Self-service onboarding доменов | Год 2 |
| Сокращение time-to-market для отчётов | Data Products готовы к использованию | Год 1 (пилот) |
| Масштабирование до петабайтов | LakeHouse с горизонтальным масштабированием | Год 2-3 |
| Near-real-time аналитика | Kafka + streaming витрины | Год 3 |

